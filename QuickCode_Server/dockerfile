
FROM node:18-alpine

# Install system dependencies for code execution
RUN apk add --no-cache \
    gcc \
    g++ \
    make \
    python3 \
    python3-dev \
    py3-pip \
    openjdk11-jre \
    openjdk11-jdk \
    redis \
    bash

# Set working directory
WORKDIR /app

# Copy package files for both services
COPY backend/package*.json ./backend/
COPY Worker-1/package*.json ./Worker-1/

# Install dependencies for both services
RUN cd backend && npm install --production
RUN cd Worker-1 && npm install --production

# Copy source code
COPY backend/src ./backend/src
COPY Worker-1/src ./Worker-1/src

# Create necessary directories
RUN mkdir -p Worker-1/temp_cpp Worker-1/temp_python Worker-1/temp_java Worker-1/temp_js

# Set permissions for temp directories
RUN chmod -R 777 Worker-1/temp_*

# Expose ports
EXPOSE 8080 6377

CMD ["node", "backend/src/index.js"]
CMD ["node", "Worker-1/src/index.js"]